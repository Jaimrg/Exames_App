"use strict";
// import swal from 'sweetalert';
// var filerefjs = document.createElement('script');
// filerefjs.setAttribute("type", "text/javascript");
// filerefjs.setAttribute("src", "https://unpkg.com/sweetalert/dist/sweetalert.min.js");


// import {seconds, minutes} from '../time';
$(document).ready(function () {
  //document.getElementById('next-btn').innerHTML = 'Proximo';                
  // Step show event
  $("#smartwizard").on("showStep", function (e, anchorObject, stepNumber, stepDirection, stepPosition) {

    //alert("You are on step "+stepNumber+" now");
    if (stepPosition === 'first') {
      //document.getElementById("next-btn").innerText = 'Proximo';
      $("#prev-btn").addClass('disabled');
    } else if (stepPosition === 'final') {
      $("#next-btn").addClass('disabled');
    } else {
      $("#prev-btn").removeClass('disabled');
      $("#next-btn").removeClass('disabled');
    }
  }); // Toolbar extra buttons


  // if (seconds == 0 && minutes == 0) {

  // }

  var btnFinish = $('<button></button>').text('Finalizar').addClass('btn btn-success').on('click', function () {
    // let currentDate = date.getDate() + "/" + (date.getMonth() + 1) + "/" + date.getFullYear();
    // let currentTime = date.getHours() + ":" + date.getMinutes();

    // localStorage.data_fim = currentDate;
    // localStorage.hora_fim = currentTime;

    swal({
      title: 'Tem Certeza que pretende finalizar?',
      text: "Essa Acção é irreversível!",
      type: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#0CC27E',
      cancelButtonColor: '#FF586B',
      confirmButtonText: 'Sim, Finalizar!',
      cancelButtonText: 'Não, cancelar!',
      confirmButtonClass: 'btn btn-success mr-5',
      cancelButtonClass: 'btn btn-danger',
      buttonsStyling: false
    }).then(function () {

      let perguntas = [];
      let respostas = [];


      for (let i = 0; i < 4; i++) {
        perguntas.push(document.getElementById('pergunta_' + (i + 1) + '_input').value);
        respostas.push(Array.from(document.getElementsByName((i + 1) + "_opa")).find(r => r.checked) == undefined ? 0 : Array.from(document.getElementsByName((i + 1) + "_opa")).find(r => r.checked).value);
      }

      let perguntas_final = [];
      console.log(localStorage.total);
      for (let i = 0; i < localStorage.total; i++) {
        perguntas_final.push({ "id": perguntas[i], "resposta": respostas[i] });
      }

      // console.log(JSON.stringify(perguntas_final));
      // console.log(perguntas_final);
      // console.log(localStorage.hora_inicio);
      // console.log(localStorage.hora_fim);
      // console.log(localStorage.data_inicio);
      // console.log(localStorage.total);
      $.ajax({
        url: 'http://127.0.0.1:5000/exames',
        dataType: 'json',
        type: 'POST',
        contentType: 'application/json',
        data: JSON.stringify({
          "examinando_id": 3,
          "marcacao_id": "",
          "respostas": {
            "perguntas": perguntas_final
          },
          "hora_inicio": localStorage.hora_inicio,
          "hora_fim": localStorage.hora_fim,
          "data": localStorage.data_inicio,
          "local_id": 1,
          "pontuacao": "",
          "total_perguntas": localStorage.total,
          "resultado": ""
        }
          // { "": $('#').val(), "": $('#').val() }
        ),
        processData: false,
        success: function (data, textStatus, jQxhr) {
          console.log(data);
          swal({
            title: 'Finalizado!',
            text: 'Seu Exame Já Terminou.',
            timer: 2000,
            type: 'success',
            showCancelButton: false,
            showConfirmButton: false
          }).then(
            function () {



            },
            // handling the promise rejection
            function (dismiss) {
              if (dismiss === 'timer') {
                //console.log('I was closed by the timer')
              }
            }
          );
          //alert('http://192.168.16.119:5000/examinandos/' + localStorage.id_examinando);
          $.ajax({
            url: 'http://192.168.16.119:5000/examinandos/' + localStorage.id_examinando,
            method: 'DELETE',
            headers: {
              'Content-Type': 'application/json'
            },
            data: JSON.stringify({

            }),
            dataType: "json",
            success: function (data) {
              setTimeout(function () {
                window.location.assign('http://192.168.16.119/inatro_exames/');
            }, 2000);
            }
          });

          // setTimeout(function () {
          //   window.location.assign('http://192.168.16.119/inatro_exames/');
          // }, 2000);

          // swal('Finalizado!', 'Seu Exame Já Terminou.', 'success'); 
          //alert(data);

        },
        error: function (jqXhr, textStatus, errorThrown) {
          console.log(errorThrown);
        }
      });
    }, function (dismiss) {
      // dismiss can be 'overlay', 'cancel', 'close', 'esc', 'timer'
      if (dismiss === 'cancel') {
        swal({
          title: 'Continue o Exame!',
          text: ':)',
          timer: 2000,
          type: 'error',
          showCancelButton: false,
          showConfirmButton: false
        }).then(
          function () { },
          // handling the promise rejection
          function (dismiss) {
            if (dismiss === 'timer') {
              //console.log('I was closed by the timer')
            }
          }
        )

      }
    });

  });
  var btnCancel = $('<button></button>').text('Recomeçar').addClass('btn btn-danger').on('click', function () {
    $('#smartwizard').smartWizard("reset");
  }); // Smart Wizard

  $('#smartwizard').smartWizard({
    selected: 0,
    theme: 'default',
    transitionEffect: 'fade',
    showStepURLhash: true,
    toolbarSettings: {
      toolbarPosition: '',
      toolbarButtonPosition: 'end',
      toolbarExtraButtons: [btnFinish]
    }
  }); // External Button Events

  $("#reset-btn").on("click", function () {
    // Reset wizard
    $('#smartwizard').smartWizard("reset");
    return true;
  });
  $("#prev-btn").on("click", function () {
    // Navigate previous
    $('#smartwizard').smartWizard("prev");
    return true;
  });
  $("#next-btn").on("click", function () {
    // Navigate next
    $('#smartwizard').smartWizard("next");
    return true;
  });
  $("#theme_selector").on("change", function () {
    // Change theme
    $('#smartwizard').smartWizard("theme", $(this).val());
    return true;
  }); // Set selected theme on page refresh

  $("#theme_selector").change();
});